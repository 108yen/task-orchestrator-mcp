# 設計

## 1. データモデル

`Task` オブジェクトは以下の情報を持つ。

| フィールド名  | 型                    | 説明                                                         |
| :------------ | :-------------------- | :----------------------------------------------------------- |
| `id`          | `string`              | タスクを一意に識別するためのID。UUIDを想定。                 |
| `name`        | `string`              | タスクの名称。                                               |
| `description` | `string`              | タスクの詳細な説明。                                         |
| `status`      | `string`              | タスクの進捗状況。例: `'todo'`, `'in_progress'`, `'done'`    |
| `resolution`  | `string \| undefined` | タスク完了時の状態や結果を記載する。未完了時は `undefined`。 |
| `parent_id`   | `string \| undefined` | 親タスクのID。トップレベルのタスクの場合は`undefined`。      |
| `order`       | `number`              | 兄弟タスク内での実行順序を示す数値。小さい方から実行される。 |
| `createdAt`   | `Date`                | タスクの作成日時。                                           |
| `updatedAt`   | `Date`                | タスクの最終更新日時。                                       |

## 2. 主要機能の実装方針

### 2.1. CRUD操作

- **タスクの作成 (Create)**
  - `order` が指定されない場合、兄弟タスクの `order` の最大値 + 1 を自動設定する。
- **タスクの一覧取得 (Read)**
- **タスクの更新 (Update)**
- **タスクの削除 (Delete)**

### 2.2. タスク実行管理

- **`startTask(id: string)`**: 指定されたタスクの `status` を `'in_progress'` に更新する。
- **`completeTask(id: string)`**:
  - 指定されたタスクの `status` を `'done'` に更新し、`resolution` を設定する。
  - 戻り値として、次に実行すべきタスクのID、または完了メッセージを返す。
  - **次のタスクの決定ロジック**:
    1. 完了タスクの兄弟タスク（同じ `parent_id`）の中から、`order` が大きく、かつ `status` が `'todo'` のものを探す。
    2. 見つかればそのIDを返し、見つからなければ完了メッセージを返す。

## 3. データ永続化の実装方針

- **永続化モードの決定**: 起動時に環境変数 `FILE_PATH` を確認する。
- **ファイル永続化モード (`FILE_PATH` あり)**:
  - 起動時、指定されたパスのJSONファイルを読み込む。
  - データ更新（CRUD、ステータス変更など）の都度、全データをファイルに書き込む。
- **インメモリモード (`FILE_PATH` なし)**:
  - データはメモリ上の配列で管理する。
