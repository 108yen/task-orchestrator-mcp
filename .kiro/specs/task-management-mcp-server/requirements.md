# Requirements Document

## Introduction

エージェントに対してタスクを管理するためのツール群を提供するMCPサーバーです。タスクのCRUD操作および、進捗管理等の機能を提供し、AIエージェントが実行すべきタスクを階層構造で管理できるシステムを構築します。

## Requirements

### Requirement 1

**User Story:** AIエージェントとして、階層構造でタスクを作成・管理したい。複雑なワークフローを親子関係で整理できるようにするため。

#### Acceptance Criteria

1. タスクが作成されたとき、システムはタスクに一意のIDを割り当てること
2. parent_idを指定してタスクが作成されたとき、システムは親子関係を確立すること
3. タスクが作成されたとき、システムは名前、説明、ステータス、作成日時、更新日時を保存すること
4. parent_idが提供されない場合、システムはトップレベルのタスクを作成すること
5. ルートタスク（parent_idが未指定）が作成された場合、システムはそのタスクを達成するためのサブタスクの作成を推奨する内容も含めて返すこと

### Requirement 2

**User Story:** AIエージェントとして、タスクのCRUD操作を実行したい。タスクデータの完全なライフサイクルを管理できるようにするため。

#### Acceptance Criteria

1. タスク作成時、システムは名前、説明、parent_id、順序パラメータを受け入れること
2. タスク作成時にorderが未指定の場合、システムは兄弟タスクの最大order値+1を自動的に割り当てること（兄弟がいない場合は1）
3. タスク作成時にorderが指定され既存のorderと重複する場合、システムは既存タスクのorderを1ずつ増加させて挿入処理を行うこと
4. タスク取得時、システムはIDによって完全なタスクオブジェクトを返すこと
5. タスク一覧取得時、システムはparent_idによるフィルタリングをオプションで提供すること
6. タスク更新時、システムは指定されたフィールドを変更し、タイムスタンプを更新すること
7. タスク削除時、システムはストレージからタスクを削除すること

### Requirement 3

**User Story:** AIエージェントとして、タスクの実行順序とステータスを管理したい。進捗を追跡し、次のアクションを決定できるようにするため。

#### Acceptance Criteria

1. タスク開始時、システムはステータスを'in_progress'に変更すること
2. タスク開始時、そのタスクにサブタスクがある場合、完了していない最初のサブタスクのステータスも'in_progress'に変更し、その旨を返すこと
3. タスク完了時、システムはステータスを'done'に変更し、解決内容を記録すること
4. タスク完了時、システムは次に実行すべきタスクを特定すること
5. 次のタスクが存在しない場合、システムは全タスクの完了を示すこと
6. タスクに順序値がある場合、システムは昇順で実行すること
7. タスク完了時、システムは全体の進捗状況をマークダウンテーブル形式で表示すること
8. 進捗サマリーには、各親タスクの進行状況、完了済みサブタスク数、残りサブタスク数、完了率を含むこと
9. 進捗サマリーには、全体統計（総タスク数、完了済み数、進行中数、未着手数、完了率）を含むこと

### Requirement 4

**User Story:** システム管理者として、設定可能なデータ永続化を利用したい。ファイルベースのストレージとインメモリ操作を選択できるようにするため。

#### Acceptance Criteria

1. FILE_PATH環境変数が設定されている場合、システムは指定されたJSONファイルにデータを永続化すること
2. FILE_PATH環境変数が設定されていない場合、システムはメモリのみのモードで動作すること
3. ファイル永続化を使用する場合、システムは起動時に既存データを読み込むこと
4. ファイル永続化を使用する場合、システムは各変更後にデータを書き込むこと
5. メモリモードを使用する場合、システムはファイル操作を実行しないこと

### Requirement 5

**User Story:** 開発者として、システムがMCP準拠のツールを提供することを求める。MCP互換クライアントと統合できるようにするため。

#### Acceptance Criteria

1. サーバー起動時、システムは全てのタスク管理ツールをMCPサーバーに登録すること
2. ツールが呼び出されたとき、システムはツールスキーマに従って入力パラメータを検証すること
3. ツールが正常に実行されたとき、システムは期待される出力形式を返すこと
4. エラーが発生したとき、システムは適切なエラーメッセージを返すこと
5. サーバーが実行されているとき、システムは通信にStdioServerTransportを使用すること
